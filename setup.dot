#

digraph D {

  dpi = 196

  node [
    shape     = record
  ]

  edge [
    arrowhead = normal
    arrowsize = 0.7
  ]

  splines  = ortho;
  ranksep  = 0.75;
  nodesep  = 0.75;

  subgraph cluster_database {

    bgcolor  = chartreuse3
    label    = "database"

    mysql         [ label = "mysql" ]
    mongodb       [ label = "mongodb" ]
  }


  subgraph cluster_backend {

    label    = "backend"
    bgcolor  = lightblue

    httpd_be        [ label = "httpd" ]
    cae_preview     [ label = "cae-preview" ]
    studio          [ label = "studio" ]
    solr_be         [ label = "solr" ]

    httpd_be        -> cae_preview
    httpd_be        -> studio

    cae_preview     -> solr_be
    cae_preview     -> mongodb
    cae_preview     -> cms

    content_feeder  -> cms
    content_feeder  -> solr_be

    cms             [ label = "content-management-server" color = "dodgerblue" style = filled ]
    content_feeder  [ label = "content-feeder" ]
    user_changes    [ label = "user-changes" ]
    elastic_worker  [ label = "elastic-worker" ]
    sitemanager     [ label = "sitemanager" ]
    feeder_preview  [ label = "caefeeder-preview" ]

    workflow_server [ label = "workflow-server" ]

    studio          -> workflow_server
    studio          -> solr_be
    studio          -> cms
    studio          -> mongodb

    cms             -> solr_be
    workflow_server -> cms
    workflow_server -> mongodb

    feeder_preview  -> solr_be
    feeder_preview  -> cms

    elastic_worker  -> cms
    elastic_worker  -> mongodb

    user_changes    -> cms
    user_changes    -> mongodb

    sitemanager     -> cms

    cms             -> mysql
    feeder_preview  -> mysql
  }

  subgraph cluster_frontend {

    label   = "frontend cluster"
    bgcolor = chartreuse3

    subgraph cluster_content_server {

      label   = "content server"
      bgcolor = antiquewhite

      mls         [ label = "master-live-server" color = "dodgerblue" style = filled ]
      feeder_live [ label = "caefeeder-live" ]
      solr_fe     [ label = "solr (master)" ]


      feeder_live     -> solr_fe
      feeder_live     -> mls
      feeder_live     -> mysql
      // mls             -> rls [ dir=both ]
      mls             -> mysql

      cms             -> mls [ penwidth = 2, color = "red" ]
    }


    subgraph cluster_delivery {

      label   = "delivery"
      bgcolor = antiquewhite

      httpd_fe      [ label = "httpd" ]
      rls           [ label = "replication-live-server" color = "dodgerblue" style = filled ]
      cae1          [ label = "cae-live-1" ]
      cae2          [ label = "cae-live-2" ]
      cae3          [ label = "cae-live-3" ]

      solr_fe_slave [ label = "solr (slave)" ]

      httpd_fe  -> cae1
      httpd_fe  -> cae2
      httpd_fe  -> cae3

      solr_fe_slave -> solr_fe

      cae1      -> rls
      cae1      -> solr_fe_slave

      cae2      -> rls
      cae2      -> solr_fe_slave

      cae3      -> rls
      cae3      -> solr_fe_slave

      rls       -> mysql
      rls       -> mls [ penwidth = 2, color = "red" ]
    }
  }
}
