---

# - debug:
#     var: "{{ item }}"
#   when: item is defined
#   loop:
#     - play_hosts
#     - inventory_hostname
#     - inventory_hostname_short

- name: Include OS-specific variables.
  include_vars:
    file: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution | lower }}.{{ ansible_lsb.codename | lower }}.yml"
    - "{{ ansible_distribution | lower }}.{{ ansible_lsb.major_release }}.yml"
    - "{{ ansible_distribution | lower }}.yml"
    - "{{ ansible_os_family | lower }}.yml"
    - default.yml

- include_tasks: fqdn.yml

- name: set timezone to UTC
  timezone:
    name: UTC

- name: Make sure Ansible local facts directory exists
  file:
    dest: '/etc/ansible/facts.d'
    state: 'directory'
    owner: 'root'
    group: 'root'
    mode: '0755'

- name: ensure needed packages are installed
  package:
    name: "{{ item }}"
    state: present
  loop:
    "{{ additional_packages }}"

- name: add subdomains to /etc/hosts
  template:
    src: templates/hosts.j2
    dest: /etc/hosts

- name: change bash_profile
  template:
    src: bash_profile.j2
    dest: /root/.bash_profile

- name: ensure unneeded services are stoped and disabled
  service:
    name: "{{ item }}"
    state: stopped
    enabled: false
  ignore_errors: true
  no_log: true
  loop:
    "{{ unneeded_services }}"
